group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Mood related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
# Poisson test
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
cmh <- cmh_mh %>%
filter(Type=='Psychosis related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Psychosis related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Psychosis related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
# Poisson test
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
View(cmh)
View(grh)
View(smh)
View(data)
cmh <- cmh_mh %>%
filter(Type=='Situational crisis') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Situational crisis') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Situational crisis') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
# Poisson test
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
View(data)
View(cmh)
View(grh)
View(smh)
?replace_na()
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace_na(0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
smh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='smh') %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
police <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='pol')
View(cmh_mh)
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
smh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='smh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
police <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='pol')
cmh <- cmh_mh %>%
filter(Type=='Situational crisis') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Situational crisis') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Situational crisis') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
# Poisson test
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
View(cmh_mh)
cmh <- cmh_mh %>%
filter(Type=='Self harm') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Self harm') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Self harm') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
# Poisson test
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
View(cmh)
View(grh)
View(smh)
View(data)
cmh <- cmh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
View(data)
View(cmh)
View(grh)
View(data)
View(grh_mh)
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
smh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='smh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count') %>%
mutate(date=paste(week, Year, sep=' '))
police <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='pol')
cmh <- cmh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
cmh <- cmh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- grh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
smh <- smh_mh %>%
filter(Type=='Substance related') %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
data <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
# Poisson test
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
get_data <- function(data, type, subtype=NULL) {
if (is.null(subtype)) {
smh <- data$smh_mh %>%
filter(Type==type) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- data$grh_mh %>%
filter(Type==type) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
cmh <- data$cmh_mh %>%
filter(Type==type) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
} else {
smh <- data$smh_mh %>%
filter(Type==type, Subtype==subtype) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- data$grh_mh %>%
filter(Type==type, Subtype==subtype) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
cmh <- data$cmh_mh %>%
filter(Type==type, Subtype==subtype) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
}
whole <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
return(whole)
}
mh <- list(smh_mh=smh_mh, grh_mh=grh_mh, cmh_mh=cmh_mh)
data <- get_data(mh, 'Form 1 Total')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
View(data)
data <- get_data(mh, 'Substance related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Substance related', 'Alcohol (separate)')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Mood related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Psychosis related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Situational crisis')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Self harm related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
data <- get_data(mh, 'Self harm')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
library(tidyverse)
library(readxl)
library(tibbletime)
library(lubridate)
# volume data
cmh_ed <- read_excel('data/ED Volume Cambridge.xlsx')
grh_ed <- read_excel('data/ED volumes GRH.xlsx')
smh_ed <- read_excel('data/ED volumes SMH.xlsx')
# mental health data
cmh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='cmh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count')
grh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='grh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count')
smh_mh <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='smh') %>%
replace(is.na(.), 0) %>%
pivot_longer(cols = `March 1 - March 7`:`August 30th - September 5th`,
names_to='week',
values_to='count')
# Police data
police <- read_excel('data/COVID-19 data sheet edited Jan 23.xlsx', sheet='pol')
vol <- smh_ed %>% left_join(grh_ed, by=c("Date of ED visit (reg)" = "Day of Triage_DT")) %>%
left_join(cmh_ed, by=c("Date of ED visit (reg)" = "Triage Date")) %>%
rename(date=`Date of ED visit (reg)`, smh=`# of cases`, grh=`Number of Records`, cmh=Volume) %>%
mutate(total=smh+grh+cmh) %>%
mutate(year=as.factor(year(date)))
p <- vol %>% drop_na() %>%
mutate(date = if_else(year==2019, date+years(1), date)) %>%
ggplot(aes(x=date, y=total, color=year)) +
geom_line() +
scale_color_manual(values=c("green", "blue")) +
ylab('daily ED visits') +
annotate('rect', xmin=as.POSIXct('2020-03-17'), xmax=as.POSIXct('2020-05-04'),
ymin=-Inf, ymax=Inf, fill='red', alpha=0.3)
ggsave('graphs/vol.png', p, height = 8.5, width = 11, units = 'in')
p
vol %>% mutate(date=as.Date(date)) %>%
filter(date>='2019-03-17' & date<='2020-05-04') %>%
filter(date<='2019-05-04' | date>='2020-03-17') %>%
ggplot(aes(x=total, fill=year)) +
geom_histogram()
data <- vol %>% mutate(date=as.Date(date)) %>%
filter(date>='2019-03-17' & date<='2020-05-04') %>%
filter(date<='2019-05-04' | date>='2020-03-17')
# Poisson regression
poisson_out <- glm(total ~ year, family='quasipoisson', data=data)
summary(poisson_out)
get_data <- function(data, type, subtype=NULL) {
if (is.null(subtype)) {
smh <- data$smh_mh %>%
filter(Type==type) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- data$grh_mh %>%
filter(Type==type) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
cmh <- data$cmh_mh %>%
filter(Type==type) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
} else {
smh <- data$smh_mh %>%
filter(Type==type, Subtype==subtype) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
grh <- data$grh_mh %>%
filter(Type==type, Subtype==subtype) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
cmh <- data$cmh_mh %>%
filter(Type==type, Subtype==subtype) %>%
group_by(Year, week) %>%
summarize(count=sum(count)) %>%
mutate(date=paste(week, Year, sep=' '))
}
whole <- smh %>%
left_join(grh, by='date') %>%
left_join(cmh, by='date') %>%
mutate(total=count+count.x+count.y) %>%
select(Year, week, total) %>%
mutate(Year=as.factor(Year))
return(whole)
}
mh <- list(smh_mh=smh_mh, grh_mh=grh_mh, cmh_mh=cmh_mh)
data <- get_data(mh, 'Form 1 Total')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Substance related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Substance related', 'Alcohol (separate)')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Mood related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Psychosis related')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Situational crisis')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
data <- get_data(mh, 'Self harm')
poisson_out <- glm(total ~ Year, data=data, family='quasipoisson')
summary(poisson_out)
